<html>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <head>
        <style>
        h1 {text-align: center;}
        h2 {text-align: center;}
        h4 {text-align: center;}
        p {text-align: center;}
        div {text-align: center;}

        .bar {
            fill: steelblue;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        </style>
    
    </head>
    <body onload='init()'>
        <h1>What is the recipe to a best selling video game?</h1>
        <h4>CS 416 Narrative Visualization by Isabella Iniguez</h4>
        <h3>Intro</h3>
        <p>With the rise in big publisher’s focus on remakes and reboots while indie gaming continues to scale (thanks to platforms like Roblox and Steam), one may question what tends to make a game successful compared to all the available titles out there. In this interactive slideshow, we aim to uncover the elements that contribute to a best-selling video game. </p>
        <h3>Average Metacritic Score by Genre</h3>
        <p>Here in this first barplot, we can see the trends in what video game genres tend to be rated highest (metacritic). </p>
            <p>Is this what you would have expected?</p>

            <div id="chart"></div>
            <div id="tooltip" class="tooltip"></div>
            <!-- <svg width="300" height="300"></svg> -->
            <!-- <div name=“tooltip” opacity=0></div>  -->
            
        <script>
            async function init(){
                const data = await d3.csv('https://iniguezisabella.github.io/data/genre_ratings.csv');

                var width = 500;
                var height = 250;
                var x = d3.scaleBand()
                    // .domain(data.map(d => d.Genre))
                    // .range([0,width]) //
                    // .padding(0.2);
                    .domain(data.map(d => d.Genre))
                    .range([0, width])
                    .padding(0.1);
                var y = d3.scaleLinear()//.domain([68,80]).range([height,0])
                    .domain([63, d3.max(data, d => d.metacritic)])
                    .nice()
                    .range([height, 0]);
                var margin = 75; // changed from 50

                const svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width + 2*margin)
                    .attr("height", height + 2*margin)
                    .append("g")
                    .attr("transform", "translate("+margin+","+margin+")") //
                    // .selectAll('rect').data(data).enter().append('rect') //bars
                    // .attr("x",function(d,i) {return x(d.Genre);}) // {return x(i);})
                    // .attr("y",function(d,i) {return y(d.metacritic);}) // {return y(d);})
                    // .attr('width', x.bandwidth())
                    // .attr('height',function(d,i) {return height - y(d.metacritic);})
                    // .attr("fill", "#69b3a2")

                svg.append("g")
                    .attr("class", "y-axis") //
                    // .attr("transform", "translate("+margin+","+margin+")")
                    .call(d3.axisLeft(y));

                svg.append("g")
                    .attr("class", "x-axis") //
                    .attr("transform", "translate(0,"+(height)+")")
                    .call(d3.axisBottom(x))
                    // .selectAll("text")  
                    // .style("text-anchor", "end")
                    // .attr("dx", "-.8em")
                    // .attr("dy", ".15em")
                    // .attr("transform", "rotate(-65)");

                const tooltip = d33.select("#tooltip");
                
                svg.selectAll(".bar") // bars
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x",function(d,i) {return x(d.Genre);}) // {return x(i);})
                    .attr("y",function(d,i) {return y(d.metacritic);}) // {return y(d);})
                    .attr('width', x.bandwidth())
                    .attr('height',function(d,i) {return height - y(d.metacritic);})
                    // .attr("x", d => x(d.Genre))
                    // .attr("y", d => y(d.metacritic))
                    // .attr("width", x.bandwidth())
                    // .attr("height", d => height - y(d.value))
                    .on("mouseover", (event, d) => {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html(`Genre: ${d.Genre}<br>Meta: ${d.metacritic}`)
                            .style("left", (event.pageX + 5) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", () => {
                        tooltip.transition().duration(500).style("opacity", 0);
                    });
            }

        </script>

        <div class="navbar">
            <a href="CS416NarViz-A.html">1</a>
            <a href="CS416NarViz-B.html">2</a>
            <a href="CS416NarViz-C.html">3</a>
            <a href="backup.html">test</a>
          </div>
    
          <p>Dataset: <a href="https://www.kaggle.com/datasets/dem0nking/video-game-ratings-dataset">Kaggle</a> </p> 
    </body>
</html>